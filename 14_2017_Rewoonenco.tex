\documentclass[10pt, a5paper]{article}
\input{preamble.tex}
\switchlang{ru}
\begin{document}
\title{Практическое использование сервисов контейнеризации в облаке Амазон}
\author{Andrew Rewoonenco, Minsk, Belarus\footnote{\url{arewoonenco@gmail.com} \url{https://lvee.org/ru/abstracts/255}}}
\maketitle
\begin{abstract}
Amazon cloud service (AWS) provides several container-based services (EC2 CS, Lambda, CodeBuild). These services are quite special to Amazon and differ a lot from Open Source analogs however based on them. The goal of this report is to review common problems based on real experience and to show solutions author had find out.
\end{abstract}

\subsection*{Введение}
Современные технологии часто ориентируются на облачные сервисы из-за их
высокой надёжности и простой расширяемости. Один из старейших облачных
провайдеров это Амазон (обычно сокоащаемый до AWS). Он предоставляет
огромный набор различных сервисов, очень хорошо связанных в единое целое.

Здесь мы затронем сервисы, связаные с контейнеризацией.
Доклад основан исключительно на эмпирических выводах (реальном
использовании), и иногда достаточно сильно расходится с декларируемыми или
ожидаемыми особенностями сервисов и их использования.

Из большого набора сервисов Амазона с контейнеризацией мы рассмотрим
несколько сервисов, по которым есть достаточно достоверная выборка:

\begin{itemize}
\item сервис контейнеризации Амазона (EC2 CS);
\item сервис краткосрочных операций (Lambda);
\item сервис компиляции/тестирования (CodeBuild).
\end{itemize}

Общее у них следующее:

\begin{enumerate}
\item Все эти сервисы запускаются на виртуальных машинах (инстансах), работающих под управлением Amazon Linux.
\item Они построены на сервисе контейнеризации docker.
\item Возможно контролировать практически все параметры контейнера.
\end{enumerate}

Рассмотрим декларируемое назначение, недостатки и способы их исправления
для каждого из сервисов.

\subsection*{Сервис контейнеризации Амазона (EC2 CS)}

Декларируемое назначение данного сервиса это разнообразные
высокодоступные сервисы, обслуживающие входящий трафик, преимущественно
веб-сервисы.

Обычный сценарий работы: создаётся кластер контейнеров из нескольких ВМ
(инстансов), и сервис запускается на них. Для высокодоступности
используется ещё один сервис Амазона --- Балансировщик (ELB),
перенаправляющий запросы по необходимости в несколько контейнеров и даже
умеющий расширять их число при повышении нагрузки.

Но в реальных сценариях использования он имеет ряд недостатков:

\begin{enumerate}
\item Фиксированное ограничение CPU/Memory.
\item При размещении нескольких контейнеров на 1 ВМ это не работает, если
  котнейнеры используют одни и те же порты.
\item Не умеет распределять контейнеры правильно по датацентрам Амазона
  (Availability Zone), и из-за этого нестабильно работает балансировщик
  нагрузки.
\item Псегда надо иметь резерв по ВМ, иначе при перезапуске сервиса можно
  попасть в Deadlock.
\end{enumerate}


\subsection*{Сервис краткосрочных операций (Lambda)}

Декларируемое назначение данного сервиса это разнообразные
высокодоступные краткосрочные клиент-сервисы, например, системы
мониторинга, контроля, сообщений. Имеют жёткий лимит на время действия
--- не более 5 минут, используют только скрипт для работы (python, java
jar, javascript nodejs). Не имеют входящих портов принципиально, но умеют
обрабатывать сообщения из очередей Амазона (например SNS).

Сервис очень удобен для крошечных простейших операций (например,
проверить веб-сервера и отослать СМС в случае недоступности) но при
более-менее серьёзном использовании очень ограничен. В реальных
сценариях использования имеет ряд недостатков:

\begin{enumerate}
\item Из-за времени использования многие возможности принципиально
  недоступны.
\item Нет входящих портов или протокола UDP за редкими исключениями.
\item Отладка просто чудовищно сложна из-за использования \linebreak CloudWatch для
  хранения логов.
\item Работа с бинарными приложениями страшно неудобна и сложна.
\item Доступ к сервису SSH весьма нетривиален.
\end{enumerate}

\subsection*{Сервис компиляции/тестирования (CodeBuild)}

Декларируемое назначение данного сервиса это
компиляция/сборка/тестирование разнообразного кода. В идеале позволяет
заменить комбайн типа Jenkins на контейнеризованные решения. Стандартное
использование --- исходный код забирается с хранилища S3 (веб-хранилище
Амазона), строится в контейнере, записывается снова на S3.

Сервис очень удобен для стандартный простейших операций (скомпилировать),
но для более-менее сложных проектов ограничен. В реальных сценариях
использования имеет ряд недостатков:

\begin{enumerate}
\item Для сервиса надо вначале подготовить базовый контейнер с системой
  сборки.
\item Отладка построения очень сложна из-за использования \linebreak CloudWatch для
  хранения логов.
\item Сама постройка требует очень много времени из-за частей: развернуть
  контейнер, забрать файлы, положить файлы.
\item При постройке есть фиксированный набор этапов, он выполняется весь,
  даже если этап вернул ошибку, и только в конце сообщается о неудаче.
\item Интеграция «из коробки» через CodePipeline с git (например с гитхабом)
  очень ограничена.
\end{enumerate}

\subsection*{Заключение}

Как мы видим, декларируемые и реальные сценарии использования сервисов
Амазона весьма отличаются. Несмотря на то, что все сервисы базируются
на хорошо известных открытых решениях, стандартные сценарии их
использования внутри системы Амазон не подходят. Да и рекомендованные
самим Амазоном не особо хороши при использовании, чуть отклоняющемся от стандартного.

\end{document}
