\documentclass[10pt, a5paper]{article}
\input{preamble.tex}
\begin{document}
\title{О Модели Данных SQL/JSON}
\author{Андреев Юрий, Санкт-Петербург, РФ\footnote{\url{andreev.yurij@gmail.com}}}
\maketitle
\begin{abstract}
An SQL/JSON model is a part of SQL 2016 Standard\cite{AY1} which describes a JSON data model for SQL.
It describes a \textit{jsonpath} data type as a path language and nine functions to deal with JSON data.
A new type of queries will be shown on a special branch of PostgreSQL.
\end{abstract}

\subsection*{Введение}
В новою редакцию стандарта SQL\cite{AY1} была включена SQL/JSON модель.
Это означает, что стандарт теперь предполагает работу со слабо-структурированными
данными в JSON формате\cite{AY2}. СУБД PostgreSQL имеет долгую историю поддержки такого типа данных
и теперь идет работа по поддержке новых возможностей \linebreak стандарта\cite{AY4}.
Далее мы покажем, какие преимущества дает способ хранения в JSON формате и как 
предполагается делать запросы к таким данным.

\subsection*{Описание}
Для запросов в стандарте описаны девять новых функций, с префиксом 
\texttt{JSON\_ (JSON\_\{OBJECT, QUERY, ...\})},
а также \textit{jsonpath} --- язык для навигации по JSON. Это частичный аналог XPath для XML. 
Однако, в отличии от последнего, его синтаксис был продиктован уже имеющимися конструкциями в javascript. 
Выражение начинается со знака доллара, переход к дочерним элементам осуществляется оператором 'точка'.
(см. подробнее в \cite{AY3}). Путь передается во втором аргументе функций. 

\subsection*{Пример использования}
Хорошей иллюстрацией может служить список достопримечательностей. 
Допустим, мы хотели бы хранить дополнительную информацию об интересных местах. 
Если мы возьмем архитектурную достопримечательность, 
то в формате JSON информация могла бы быть записана следующим образом:
\begin{verbatim}
{
    "nearest_city": "city_name"
    "creator": "author_name"
    "style": "style_name"
    "date": {
        "start_centery": number
        "end_centery": number
    }
}
\end{verbatim}
В тоже время, для природных объектов бессмысленно указывать имя создателя или дату,
и могут понадобиться новые ключи: сведения о территории, высоте, глубине. 
С другой стороны, и те и другие могут содержать имя ближайшего населенного пункта, 
географическое расположение и прочее. 

Записать информацию в базу мы можем с помощью функций-конструкторов
\texttt{JSON\_OBJECT, JSON\_ARRAY}.

Если наши данные содержатся в колонке \texttt{details}, то запрос на наличие создателя (ключ \texttt{creator})
может выглядеть следующим образом:
\begin{verbatim}
SELECT 
    JSON_EXISTS(details, '$.creator') 
FROM table_name 
WHERE id = object_id;
\end{verbatim}
И вернет булево значение (\texttt{t/f}). 
Вывести время начала строительства можно функцией \texttt{JSON\_VALUE}:
\begin{verbatim}
SELECT 
    JSON_VALUE(details, '$.date.start_centery') 
FROM table_name 
WHERE id = object_id;
\end{verbatim}
Тут заметим, что вообще период строительства может описываться по разному, 
в зависимости от точности имеющейся информации. 
Поэтому могут понадобиться разные ключи и, соответственно, разная логика в запросе. 

\subsection*{Заключение}
Преимущество JSON/SQL модели, помимо прочего, заключается в том, 
что мы можем эффективно работать с данными, не имеющими четкой структуры. 
Компактно хранить и лаконично писать запросы к таким данным, 
добавлять новые ключи, без необходимости изменения схемы таблицы (что затратно). 

\begin{thebibliography}{9}
\bibitem{AY1} Стандарт SQL, ISO/IEC 9075-2:2016, \url{https://www.iso.org/standard/63556.html}
\bibitem{AY2} Стандарт JSON, RFC 7159, \url{https://www.rfc-editor.org/info/rfc7159}, 
\bibitem{AY3} Описание jsonpath, \url{http://goessner.net/articles/JsonPath/}
\bibitem{AY4} Исходный код PostgreSQL, sqljson branch, \url{https://github.com/postgrespro/sqljson/tree/sqljson/}
\end{thebibliography}

\end{document}
