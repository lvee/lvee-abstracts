\documentclass[10pt, a5paper]{article}
\input{preamble.tex}

\begin{document}

\title{Использование DRBD в асинхронном режиме}%\footnote{Текст данных и последующих тезисов, кроме специально оговоренных случаев, доступен под лицензией Creative Commons Attribution-ShareAlike 3.0}

\author{Вячеслав Бочаров\footnote{Минск, Belarus}}
\maketitle

\begin{abstract}
The effect on the disk subsystem access speed for different communication protocols <<A>>, <<B>>, <<C>> in construction of a failover cluster based on DRBD is reviewed.
\end{abstract}

При проектировании ИТ инфраструктуры все чаще возникает задача создания резервного датацентра, чтобы обеспечить непрерывность оказания услуг, даже в случае полного выхода из строя основного датацентра.

Основной и резервный датацентр принято размещать на территориально разнесенных площадках.

\subsection*{Описание протоколов}

Технология DRDB использует 3 типа протоколов:
\textbf{Протокол <<А>>} --- асинхронный. Запись считается завершенной после записи данных на локальный диск и факта отправки данных на удаленный сервер.
\textbf{Протокол <<С>>} --- синхронный. Запись считается завершенной в момент получения подтверждения от удаленной системы о завершении записи на диск.
\textbf{Протокол <<В>>} --- промежуточный. Запись считается завершенной после записи данных на локальный диск и получения подтверждения о приеме (но не записи) данных удаленной системой.

\subsection*{Преимущества и недостатки протоколов обмена данными}

Основные риски, которые мы рассмотрим, это нарушение целостности данных, снижение скорости обмена с дисковой подсистемой при синхронном протоколе <<С>> при нахождении второй дисковой подсистемы на удаленной площадке дата-центра.
Как видно из описания протоколов, самым медленным является протокол <<С>> , самым быстрым --- протокол <<А>>.
Практических во всех обзорах указывается использование синхронного протокола, что вполне естественно для обеспечения целостности данных.
Что произойдет, если использовать асинхронный протокол «А» либо промежуточный протокол «В», как это повлияет на скорость доступа? Мы задались целью выяснить, действительно ли это снижает надежность файлового кластера.

\subsection*{Результаты тестов кластера при применении различных протоколов}

Тесты проводились на системе из двух серверов, находящихся в разнесенных дата-центрах на расстоянии 60 километров. Связь между ними осуществляется по оптоволоконному каналу на скорости 12 Мб.

Для построения кластера использовалась технология Heartbeat DRBD на базе дистрибутива CentOS. Диски SATA Maxtor \& Seagate, файловая система ext4. Контрольные результаты тестирования доступа к локальной дисковой подсистеме 127--130 IOPS, что является нормой для таких дисков.

\textbf{Результаты тестов скорости доступа к дисковой подсистеме при использовании протокола <<С>>} --- высокая надежность, невысокая скорость.
Скорость доступа примерно равна 30--40 IOPS, проблемы с целостностью данных не наблюдается.

\textbf{Результаты тестов доступа к дисковой подсистеме при использовании протокола <<В>>} --- достаточный уровень надежности, средняя скорость.
Скорость повышается до 43--55 IOPS, что в принципе достаточно для не нагруженных файловых сервисов, хранилища виртуальных машин, для критичных сервисов очень даже неплохо.

\textbf{Результаты тестов доступа к дисковой подсистеме при использовании протокола <<A>>} --- низкий уровень надежности, высокая скорость.
Скорость доступа еще повышается до 50--57 IOPS, что в принципе тоже неплохо. В боевом режиме сбоев не наблюдается, но при искусственном стресс-тестировании (моделирование отказа обоих серверов одновременно с последовательным восстановлением) понадобилось ручное восстановление данных.

\subsection*{Выводы}

Как показывает практика, использование промежуточного протокола <<B>> дает выигрыш в скорости обращения к дисковой подсистеме и не оказывает существенного влияния на надежность, что позволяет рекомендовать его для организации кластеров высокой доступности.

В тоже время репликация по протоколу <<А>> хотя и дает выигрыш в производительности, но оставляет высокими риски, связанные с потерями данных, а при использовании низкоскоростных соединений в случае <<расщепления разума>> («split-brain») может привести к отказу системы. Данная технология отлично подходит для разнесения на основной и резервный дата-центр сервисов, связанных с хранением данных, для повышения отказоустойчивости.

Применение промежуточного протокола оправдано, когда невозможно получить высокоскоростные линии связи.



\end{document}




