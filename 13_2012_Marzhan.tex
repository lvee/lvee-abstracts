\documentclass[10pt, a5paper]{article}
\input{preamble.tex}

\begin{document}

\title{Обновление Linux с пятиминутным downtime}%\footnote{Текст данных и последующих тезисов, кроме специально оговоренных случаев, доступен под лицензией Creative Commons Attribution-ShareAlike 3.0}

\author{Николай Маржан\footnote{Киев, Украина}}
\maketitle

\begin{abstract}
The article presents and analysis for the operating system update process in the modern Linux distros, covering the options of resolving the related problems. An example of corporate sector requirements for updates is given. Author suggests his own way of resolving the issue and describes its advantages and disadvantages.
\end{abstract}


Одной из важных проблем современного мира Linux является проблема обновления всего дистрибутива с версии на версию. В дистрибутивах, нацеленных на корпоративный сектор (RHEL, Ubuntu), этими проблемами занимаются и решают их довольно успешно. В некоторых других дистрибутивах мы можем сталкиваться с серьезными трудностями при обновлении, или даже с продолжительным простоем сервисов (downtime). Простота, надежность и скорость процедуры обновления дистрибутива особенно \linebreak важны на серверах, при простое которых останавливаются бизнес"=процессы. Зачастую обновление дистрибутива на таких серверах проводят только в случаях крайней необходимости. Мотивами могут служить такие факторы, как ошибки программного обеспечения (ПО), наличие проблем безопасности в текущем ПО, а также нередки ситуации, когда для работы новой версии используемого проприетарного решения необходима более новая версия дистрибутива или ядра.

Иногда, вследствие обновления дистрибутива, мы можем получить полностью или частично неработающую систему. Например, конечный пользователь (end-user) может жаловаться на проблемы производительности, или может перестать работать какая-то часть функционала того приложения, которое установлено на данном сервере. В этот момент возникает более сложная проблема: вернуться в предыдущее состояние практически невозможно.

Автору было предложено реализовать систему обновления ПО, которая отвечала бы следующим требованиям:

\begin{itemize}
  \item Возможность возврата к состоянию <<до обновления>> через произвольный промежуток времени.
  \item Время простоя сервисов не более 5 минут.
  \item Возможность проводить все необходимые действия удаленно, без возможности физического доступа к оборудованию.
  \item Решение должно легко автоматизироваться, чтобы максимально исключить человеческий фактор.
\end{itemize}

Ни один из современных пакетных менеджеров не позволяет вернуться в гарантированно предыдущее состояние (при условии, что нужно обновить \textbf{весь} дистрибутив на две-три версии выше).

Возможен вариант с применением снимков файловой системы (snapshot), но этот подход приводит к большой потере произвольности дисковой подсистемы, а подход с заменой обычных внутренних жестких дисков на более производительную (или внешнюю) дисковую подсистему неприемлем.

Установка новой версии дистрибутива на неиспользуемый раздел HDD была одним из рассмотренных вариантов. Была предложена следующая последовательность действий на конечном сервере:

\begin{enumerate}
  \item Скачивание образа дистрибутива или готовых для установки пакетов;
  \item Установка дистрибутива на свободный раздел;
  \item Копирование конфигурационных файлов с рабочего раздела на новый, включение сервисов в автозагрузку.
  \item Настройка конфигурационного файла GRUB;
  \item Перезагрузка в новый раздел.
\end{enumerate}

Такой вариант соответствует выдвинутым требованиям, но для его реализации необходимо придерживаться следующих рекомендаций:

\begin{enumerate}
  \item Используемая дисковая подсистема должна иметь следующие логические разделы:\begin{itemize}
  \item Корневой раздел, на который будет установлена операционная система (ОС) со всем необходимым ПО.
  \item Раздел для обновлений, идентичный корневому по размеру. На этот раздел будет выполняться установка новой версии.
  \item Раздел для данных. Это самый большой раздел, на котором будут храниться данные, которые нельзя терять после обновления. Например, файлы баз данных, отчеты, лог-файлы бизнес-приложений, которые должны храниться продолжительное время и т.д.
\end{itemize}
  \item Знание списка конфигурационных файлов, которые нужно скопировать на новый раздел.
  \item Наличие KVM over IP (Remote KVM). Для случаев, если была допущена ошибка на стадии редактирования конфигурационного файла GRUB.
\end{enumerate}

Плюсами данного метода являются:

\begin{itemize}
  \item Малое время простоя. Если все операции выполнены правильно, то оно фактически равно времени перезагрузки ОС.
  \item Возможность перезагрузиться в старый раздел по истечении любого промежутка времени.
  \item При фиксированном списке установленного ПО процесс легко можно автоматизировать.
\end{itemize}



\end{document}




