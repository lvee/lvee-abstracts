\documentclass[10pt, a5paper]{article}
\hyphenation{GNU-Plot}
\input{preamble.tex}
\begin{document}
\title{Гибкая графика \LaTeX}
\author{Андреев Юрий, Санкт-Петербург, РФ\footnote{\url{andreev.yurij@gmail.com}, \url{http://lvee.org/ru/abstracts/151}}}
\maketitle
\begin{abstract}
Classification of the different types of graphics elements will be given. 
Mixed methods to work with graphics within \LaTeX \, system are examined.
A brief overview of the appropriate tools and tips are given as well.
\end{abstract}        

\section*{Введение}

Система вёрстки \LaTeX \cite{RG1} теоретически обладает неограниченными возможностями по 
набору сложных документов. Подключение соответствующих пакетов позволяет отображать такие 
сложные объекты как ноты и структурные химические формулы.   
Наиболее востребованной является возможность быстрого набора 
сложных математических формул 
(типа $\displaystyle{\oint_{\gamma} f(z)dz = 2\pi i \sum_k Res(f, a_k)}$ 
\footnote{формула вычетов, называется среди самых красивых математических формул. 
Первое место в подобных опросах обычно занимает тождество Эйлера $e^{i\pi}=-1$.}
и сложнее).
О графике \LaTeX \, можно написать книгу\cite{RG2}, в данной же статье хотелось бы заострить внимание на следующей проблеме.

Графика --- область чрезвычайно обширная. 
Многие графические элементы, типа перечисленных выше, создаются по чётко определённым правилам и поэтому 
могут быть эффективно описаны на каком-либо языке.
С другой стороны, есть элементы, требующие повышенной гибкости редактирования,
правила создания которых заранее не известны.
И в таких случаях применение программного подхода становится практически
\footnote{надо понимать не как оборот речи, а в прямом смысле. Теоретическая возможность остаётся.}
невозможным. 
Далее мы дадим классификацию элементов по типу редактирования 
и кратко опишем несколько практических приёмов работы с графикой
\footnote{описанные далее WYSIWYG (What You See Is What You Get) редакторы являются кроссплатформенными}
в рамках системы \LaTeX.

\section*{Графика по правилам и без}
\subsection*{1. Генерируемая графика}

Когда графический элемент может быть сгенерирован, он обычно описывается на языке одного из 
прикладных пакетов: R, GNUPlot, Graphviz, ROOT, Maple, Sage и др. 
Если нам нужно будет использовать полученные результаты в latex-документе, то 
их всегда можно экспортировать в форматы \texttt{ps, pdf} и
затем вставить в latex-документ с помощью пакета \texttt{graphics}.
Этот способ можно назвать \textit{обобщением}, так как экспорт производится в формат более широкого назначения. 
Но при его использовании теряется информация (читаемость). 
Поэтому, для возможности последующего редактирования и более удобного взаимодействия, 
для сохранения исходного кода, для поддержки единой стилистики,
пакеты обычно предоставляют способы интеграции с \LaTeX \,
-- \textit{конвертацию} (преобразование кода одного языка в другой) и \textit{внедрение} 
(использование кода одного языка в другом).

Это может быть экспорт в latex-формат или преобразование в формат одного из latex-пакетов.
Например, для вывода из GNUPlot в latex-формат нужно указать соответствующий обработчик\footnote{ориг. термин: \textit{terminal}}  
\texttt{set term latex} и файл вывода \texttt{set output ``plot.tex''}. 
Доступны различные варианты, \texttt{set term pstricks}, \texttt{set term epslatex} и др.

При использовании \texttt{epslatex} возможно внедрение latex надписей внутри gnuplot-файла командой 
\texttt{set label}. Это позволяет получить на выходе (\texttt{output}) два файла 
plot.eps и включающий его plot.tex, который уже при latex компиляции выдаёт графику с точно 
позиционированными поверх неё latex-надписями.\footnote{WYSIWYG-добавление latex-надписей обсуждается 
в третьей части этой секции.}     

Напротив, существует практика внедрения результатов работы прикладного пакета в latex-документ
с помощью подключения специального latex-пакета. Для GNUPlot есть latex-пакет \texttt{gnuplottex},
для Sage -- \texttt{sagetex}. Также, нельзя не упомянуть про \texttt{psfrag} и другие latex-пакеты для
работы с EPS-форматом.    

В заключении сделаем два замечания. 
Во-первых, при любом внедрении усложняется процесс компиляции. 
В случае с \texttt{gnuplottex} нужно использовать ключ компиляции: \texttt{pdflatex -shell-escape}, 
в случае \texttt{sagetex} компиляция осуществляется в два прохода. 
Во-вторых, ограничиваются возможности внедряемого языка. 

\subsection*{2. Когда нужна корректировка. Ограничения против гибкости}

Иногда возможно генерировать основу графического элемента, 
но при этом будет необходимо последующее добавление или корректировка деталей. 
Также, при создании некоторых элементов, становится трудно искать и редактировать их детали --
недостатки текстового набора тут начинают перевешивать преимущества.

В качестве примера можно привести работу с таблицами, которую лучше выполнять в WYSIWYG-редакторе. 
Потом таблицу можно будет преобразовать в latex-формат напрямую, с помощью соответствующего конвертера, 
или через формат с разделителями значений (его можно обработать latex-пакетом \texttt{pgfplotstable}).     

Ещё одним примером является пакет \texttt{grafviz} (язык \texttt{dot}).
Он работает по \textit{принципу ограничивающих условий}, когда
элементы описываются рядом ограничений по характеристикам, а реальные значения этих 
характеристик вычисляются в момент генерации. Поэтому полученный результат 
может нуждаться в корректировке \cite{RG3}. Пакет используется для отображения различных зависимостей 
(в программном обеспечении от Puppet до Trac). 

Надо заметить, что для пакета возможны те же пути внедрения, что и описанные в предыдущем разделе.
Если мы для dot-файла применим конвертер dot2tex с опцией math: 
\texttt{dot2tex -tmath --autosize example.dot > example.tex}, то latex-выражения, написанные в 
dot-файле будут корректно обработаны. Будет получен tex-файл (с хорошо поясняющими комментариями)
в pstricks- и tikz-формате. (Наряду с latex-выражениями, в dot-файле можно передавать pstricks- и tikz-инструкции
внутри поддерживаемого dot атрибута style.)
Если же мы подсоединим один из latex-пакетов \texttt{dot2texi}, \texttt{graphviz}, то сможем изъясняться на языке dot внутри latex-документа
(не забываем про ключ \texttt{pdflatex -shell-escape} при компиляции).

С непосредственным WYSIWYG-редактированием dot-файлов есть проблемы, так как происходит значительная перекомпоновка 
при внесении практически любого изменения. Для получение более подробной информации о компоновке, можно 
получить расширенный dot-вывод, применив конвертер dot2tex.
Также, можно переконвертировать dot-файл в файл svg или в файл графических пакетов pstricks, tikz  
и редактировать его уже средствами из следующего раздела.


\subsection*{3. WYSIWYG подход}
% Бурбаки не прав, что надо без рисунков. Иногда можно доказать, не приводя ни одной формулы. Вообще, есть визуалы, у которых
% более развито визуальное мышление, к примеру. Схематично что-либо показать это здорово, это способ интерпретации и презентации. 
% Можно объяснить в рисунках даже ребенку. 

Если примером задачи из первого раздела могла бы быть задача построения параболы, когда  
нужно отдать на выполнение только её формулу и, возможно, границы области вывода, примером для второго раздела могла бы быть кривая Безье, 
вычисление которой происходит на основе опорных точек, координаты которых и нужно сообщить (и делать это лучше в графическом редакторе), 
то, задача этого раздела -- построение произвольного графика. Это полностью WYSIWYG-задача.
 
Перечислим несколько редакторов, от общих к специализированным, слева на право:  
Inkscape, GeoGebra, TexMacs, LatexDraw, jPicEdt\cite{RG4}.
Экспортировать редактируемое изображение в формат latex-пакета \texttt{pstricks} умеет такой известный редактор векторной графики, как Inkscape.
Другие, помимо \texttt{pstricks}, умеют экспортировать в форматы latex-пакетов, таких как \texttt{tikz}, \texttt{eepic} или в обычный \texttt{latex}.
(Не очевидно, но чтобы сохранить файл в нужном формате в jPicEdt нужно прежде определить для документа тип: Edit $\to$ Content Type. 
Тут необходимо сказать ещё про установку jPicEdt. 
Возможно, нужно будет заменить \texttt{javaw} на \texttt{java} в файле запуска: \texttt{sudo nano /usr/bin/jpicedt}.)  
Поэтому созданный в программе векторный рисунок можно без труда преобразовать в нужный формат и использовать в latex-документе.
 
Сложности начинаются, когда необходимо редактировать код одного из latex-пакетов. 
Внутреннем форматом редакторов являются форматы на основе XML, и на данный момент нет полноценной реализации импорта latex-кода. 
Казалось бы, что импорт реализован в редакторе jPicEdt, но редактор сохраняет в комментариях свой формат внутри сгенерированного latex-файла и,
видимо, использует его при импорте. (Поддержка импорта произвольного кода заявлена на сайте программы\cite{RG4}, выдаёт ошибки парсинга) 
Это полезный приём, которым можно пользоваться, для того, чтобы объединять
весь необходимый для редактирования код в одном latex-документе. Для пользователей Emacs плагин Auctex
предоставляет удобные функции: комментирование и обратное ему действие над выделенными строками 
реализовано в виде комбинации \texttt{C-c ;} подобные действия над параграфом осуществляет комбинация \texttt{C-c \%}           
Что касается LatexDraw, то в нем есть функция вставки pstricks-кода. Но пока LatexDraw распознаёт подмножество из
тех pstricks-команд, которые умеет генерировать сам.  
   
Разумеется, возможности у редакторов различны, как в области обычной графики, так и в поддержке latex-кода. 
Редактор GeoGebra отображает формулы сразу в стиле \texttt{displaystyle} (которым отображаются формулы на отдельной строке), в 
LatexDraw эту директиву нужно включать в текст. Возможность поворачивать latex-изображение в GeoGebra осуществляется 
в командной строке редактора, командой \texttt{RotateText},
в то время как в LatexDraw его можно поворачивать как обычный векторный элемент.

Также дело усложняется, если нам нужно вставить в редактируемый документ изображение из другого файла.
Это не всегда возможно, а если возможно, то при дальнейшем экспорте изображение будет включено в код как отдельный файл,
или не включено вообще. Если нас устраивает eps-файл, то тут стоит опять напомнить про пакеты 
типа \texttt{psfrag}. Выполнить графику одним pstricks-кодом всё же можно, но стандартной задачей это не является:      
% работа с растром 

\begin{figure}[h!]
  \centering
  \includegraphics[scale=0.6, angle=90]{01_2015_Andreev_graphics_fig1}
\end{figure}

% \begin{verbatim}
% \int\sqrt\exp\exp 
% \end{verbatim} 
 

\section*{Выводы}

В рамках системы \LaTeX \, возможно совместное использование текстового формата и WYSIWYG-управления, 
что позволяет добиться необходимой гибкости в редактировании графических элементов разной природы.
Такая гибкость усложняет межпрограммное взаимодействие. Накладными расходами является также необходимость
поиска подходящих конвертеров и редакторов (можно воспользоваться \cite{RG5}) и общих соглашений по работе
над конкретной задачей.  

\begin{thebibliography}{1}
\bibitem{RG1} Comprehensive \TeX \, archive network, \url{http://ctan.org}
\bibitem{RG2} <<The \LaTeX \, Graphics Companion>>, Michel Goossens, Sebastian Rahtz, Frank Mittelbach. Русскоязычная версия была выпущена 
издательством <<Мир>> в 2002 году под названием <<Путеводитель по пакету \LaTeX \, и его графическим расширениям>>. 
\bibitem{RG3} \url{https://en.wikipedia.org/wiki/DOT_(graph_description_language)}, раздел \texttt{limitations}
\bibitem{RG4} LatexDraw -- \url{http://latexdraw.sourceforge.net/}, jPicEdt \url{http://jpicedt.sourceforge.net/}  
\bibitem{RG5} \url{http://stackoverflow.com}
\end{thebibliography}



\end{document}

% Другая ветвь - Latex и OpenOffice и т.п.
% Другая ветвь - troff, texinfo, man 
% Другая ветвь - XML и другие языки разметки
% Другая ветвь - рассмотрение: автоматические действия, no-WYSIWYG и WYSIWYG; intouch/intype действия. 
% --- автоматические: компоновка текста на странице, расстановка переносов, выравнивание, 
% --- (мы сами "руками" строки не выравниваем даже в WYSIWYG редакторе)
% --- также и в WYSIWYG Zotero - (аналог bibtex), нумерация страниц.
% --- элементы WYSIWYG: AucTeX; emacs выделяет заголовки, позиционирует подчёркивания (подчеркивания появляются сразу после окончания ввода, как выравнивание строки в word сразу после перехода на следующую). Конечно, вывод на принтер будет другим, близко к more or less: WYSIMOLWYG.
