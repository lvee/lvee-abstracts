\documentclass[10pt, a5paper]{article}
\input{preamble.tex}

\begin{document}
\title{Мониторинг Linux/FreeBSD серверов}
\author{Николай Маржан\footnote{Киев, Украина, PortaOne, Inc. \url{delgod@delgod.com}}}

\maketitle



\begin{abstract}Purposes and functions of monitoring systems are discussed, as far as general approaches to analyze the diagnostic parameters of a server. Observed information is classified into parameters received from hardware maintenance, operating system, services and typical database. Sample diagnostic parameters are presented for each category.
\end{abstract}

К стандартным целям проводимого на серверах мониторинга можно отнести:
\begin{itemize}
	\item Отслеживание критических значений диагностических параметров состояния и уведомление инженеров об их появлении.
	\item Накопление статистической информации для последующего анализа.
\end{itemize}

Уведомление о том, что система находится в критическом состоянии, является наиболее важной функцией мониторинга, так как требует немедленного вмешательства инженеров, которые занимаются поддержкой данной системы.

Даже если проблема носит временный характер (например, стопроцентная загрузка процессора, возникшая спонтанно и затем прекратившаяся через 20 минут), выяснить причину такого поведения можно только тогда, когда проблема присутствует (причиной могла быть удаленная DOS-атака).

Накопление статистической информации происходит обычно в 2-х видах:
\begin{itemize}
	\item Лог-файлы. Обычно в них записываются только те моменты, когда система входит в критическое состояние, и когда возващается в нормальное.
	\item Данные для графиков по каждому показателю.
\end{itemize}

Графики --- не менее важная часть системы мониторинга, так как только они позволяют проводить анализ состояния сервера в целом, как сложной системы. 
Используя графики для наблюдения динамики диагностических параметров, мы можем:
\begin{itemize}
	\item Увидеть, в каком состоянии находился сервер в любой момент времени в прошлом. Мы можем быстро понять, чем отличается сегодняшнее состояние от состояния недельной давности.
	\item Проследить закономерности возможной взаимосвязи между диагностическими параметрами. Например, когда повышается входящий трафик на сетевом интерфейсе --- повышается нагрузка на центральный процессор.
	\item Находить противоречия между значениями диагностических параметров. Например, сильно возросло количество запросов на чтение к базе данных, и база данных начала использовать на 1 Гб больше оперативной памяти, но при этом с жесткого диска было считано всего 100 Мб данных.
 Увидеть, в каком состоянии находился сервер в любой момент времени в прошлом. Мы можем быстро понять, чем отличается сегодняшнее состояние от состояния недельной давности.
	\item Проследить закономерности возможной взаимосвязи между диагностическими параметрами. Например, когда повышается входящий трафик на сетевом интерфейсе --- повышается нагрузка на центральный процессор.
	\item Находить противоречия между значениями диагностических параметров. Например, сильно возросло количество запросов на чтение к базе данных, и база данных начала использовать на 1 Гб больше оперативной памяти, но при этом с жесткого диска было считано всего 100 Мб данных.
\end{itemize}
Диагностическими параметрами состояния для аппаратного обеспечения являются: 
\begin{enumerate}
	\item температура центрального процессора;
	\item наличие повреждённых секторов или ошибок чтения на жестком диске;
	\item состояние аппаратного RAID-контроллера.
\end{enumerate}
К диагностическим параметрам состояния для операционной системы можно отнести:
\begin{enumerate}
	\item количество задач, ожидающих выполнения (load average);
	\item время простоя центрального процессора (idle);
	\item время простоя каждого ядра центрального процессора (idle);
	\item размер свободного места на жестком диске;
	\item нагрузка на жесткий диск;
	\item количество данных в разделе подкачки (swap);
	\item активная запись или чтение с раздела подкачки (swaping/paging);
	\item количество использованной памяти;
	\item количество памяти, потребляемой каждым приложением;
	\item скорость передачи данных на сетевых интерфейсах;
	\item подтверждение того, что сетевые интерфейсы работают на нужной скорости и в полнодуплексном режиме;
	\item количество ошибок и коллизий на сетевых интерфейсах;
	\item состояние системных буферов (freebsd vm.zone), mbuf clusters, sendfile-буферов, размер KVM, Pipe KVA;
	\item количество открытых файлов, количество открытых сокетов;
	\item отсутствие процессов-зомби;
	\item отсутствие ошибок сегментации у процессов.
\end{enumerate}
Диагностическими параметрами состояния сервисов являются:
\begin{enumerate}
	\item подтверждение того, что все критически важные сервисы запущены.
	\item подтверждение того, что сервисы успевают вычитывать данные из входящей очереди сетевой подсистемы.
	\item подтверждение того, что нет отброшенных данных вследствие полных буферов соединения (dropped due to full socket buffers).
\end{enumerate}
Диагностическими параметрами состояния базы данных MySQL являются:
\begin{enumerate}
	\item количество максимально использованных соединений;
	\item количество запросов, количество медленных запросов;
	\item количество операций записи/чтения с жесткого диска;
	\item отставание репликации.
\end{enumerate}
Как показал опыт построения систем мониторинга в гетерогенных сетях, подходы и диагностические параметры практически идентичны для операционных систем FreeBSD и Linux; основные различия связаны с мониторингом системных буферов и с некоторыми расхождениями в синтаксисе команд.
\end{document}
